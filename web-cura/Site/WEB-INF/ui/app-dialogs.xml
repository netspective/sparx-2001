<?xml version="1.0"?>

<xaf>
    <dialogs package="person">
        <dialog name="registration" heading="create-data-cmd-heading:Contact" retain-params="*" class="app.form.PersonDialog">
            <field.separator heading="Personal Information"/>
            <field.select name="prefix" caption="Prefix" choices="Mr;Ms;Mrs" required="yes" />
            <field.text name="last_name" caption="Last Name" required="yes"/>
            <field.text name="first_name" caption="First Name" required="yes"/>
            <field.text name="middle_name" caption="Middle Name" />
            <field.date name="dob" caption="Date of Birth" />
            <field.select name="gender" caption="Gender" choices="query:person.gender-list" required="yes"/>
            <field.ssn name="ssn" caption="Social Security Number" />
            <field.select name="organization" caption="Organization" choices="query:org.name-id-list" required="yes"/>

            <field.separator heading="Contact Information"/>
            <field.select name="method" caption="Method" choices="query:person.contact-methods"
                prepend-blank="yes"/>

            <field.text name="address1" caption="Street Address 1" max-length="120">
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 1"/>
            </field.text>
            <field.text name="address2" caption="Street Address 2" max-length="120" >
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 1"/>
            </field.text>
            <field.text name="city" caption="City" >
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 1"/>
            </field.text>
            <field.text name="state" caption="State" max-length="2" upper="yes">
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 1"/>
            </field.text>
            <field.zip name="zip" caption="Zip Code" >
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 1"/>
            </field.zip>
            <field.text name="country" caption="Country">
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 1"/>
            </field.text>
            <field.select name="email_type" caption="Email Type" choices="query:person.contact-email-types">
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 3"/>
            </field.select>
            <field.email name="email" caption="Email">
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 3"/>
            </field.email>
            <field.text name="url" caption="URL">
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 4"/>
            </field.text>

            <field.phone name="phone" caption="Phone">
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 2"/>
            </field.phone>
            <field.phone name="fax" caption="fax">
                <conditional action="display" partner="method" js-expr="control.selectedIndex == 2"/>
            </field.phone>
        </dialog>
    </dialogs>
	<dialogs package="org">
		<dialog name="registration" heading="create-data-cmd-heading:Account" retain-params="org_id">
			<field.debug visible="no"/>
			<field.text name="org_code" caption="Account Code" required="yes"/>
			<field.text name="org_name" caption="Name" required="yes"/>
			<field.text name="org_abbrev" caption="Abbreviation"/>
			<field.select name="org_type" caption="Type" choices="schema-enum:Org_Type_Enum">
				<conditional action="apply-flag" flag="invisible" data-cmd="edit,delete"/>
			</field.select>
			<field.select name="org_industry" caption="Industry" choices="schema-enum:Org_Industry_Enum">
				<conditional action="apply-flag" flag="invisible" data-cmd="edit,delete"/>
			</field.select>
			<field.select name="ownership" caption="Ownership" choices="schema-enum:Org_Ownership"/>
			<field.text name="ticker_symbol" caption="Ticker Symbol"/>
			<field.integer name="employees" caption="Employees"/>
			<field.select name="time_zone" caption="Time Zone" choices="Central;Eastern;Mountain;Pacific"/>
			<populate-tasks data-cmd="edit,delete">
				<exec-statement report="none" store-type="row-fields" store="form:*">
					select * from org where org_id = ?
					<params>
						<param value="request:org_id"/>
					</params>
				</exec-statement>
			</populate-tasks>
			<execute-tasks data-cmd="add">
				<exec-transaction command="begin"/>
				<exec-dml command="insert" table="org" auto-inc="org_id,org_org_id_seq" auto-inc-store="request-attr:org_id" fields="org_code,org_name,org_abbrev,ownership,ticker_symbol,employees,time_zone"/>
				<exec-dml command="insert" table="org_industry" columns="org_id=request-attr:org_id,system_id=custom-sql:oind_system_id_seq.nextval" fields="org_industry"/>
				<exec-dml command="insert" table="org_type" columns="org_id=request-attr:org_id,system_id=custom-sql:otyp_system_id_seq.nextval" fields="org_type"/>
				<exec-transaction command="end"/>
				<exec-redirect url="config-expr:${create-app-url:/account/home.jsp}?org_id=${request-attr:org_id}"/>
			</execute-tasks>
			<execute-tasks data-cmd="edit">
				<exec-dml command="update" table="org" fields="org_code,org_name,org_abbrev,ownership,ticker_symbol,employees,time_zone" where="org_id = ?" where-bind="request:org_id"/>
				<exec-redirect url="config-expr:${create-app-url:/account/home.jsp}?org_id=${request:org_id}"/>
			</execute-tasks>
			<execute-tasks data-cmd="delete">
				<exec-transaction command="begin"/>
				<exec-dml command="delete" table="org_industry" where="org_id = ?" where-bind="request:org_id"/>
				<exec-dml command="delete" table="org_type" where="org_id = ?" where-bind="request:org_id"/>
				<exec-dml command="delete" table="org" where="org_id = ?" where-bind="request:org_id"/>
				<exec-transaction command="end"/>
				<exec-redirect url="create-app-url:/account"/>
			</execute-tasks>
		</dialog>
	</dialogs>
</xaf>